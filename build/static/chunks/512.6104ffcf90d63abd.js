"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[512],{3182:function(e,n,t){t.d(n,{Z:function(){return r}});var o=t(5893),i=t(5675),s=t.n(i),a=t(6010);function r(e){var n=e.src,t=e.alt,i=e.width,r=e.height,l=e.caption,c=e.className;return(0,o.jsxs)("div",{className:"flex flex-col items-center ",children:[(0,o.jsx)("span",{className:(0,a.Z)(c||"","overflow-hidden rounded-xl"),children:(0,o.jsx)(s(),{src:n,alt:t,width:i,height:r,placeholder:"blur",blurDataURL:n})}),l&&(0,o.jsx)("p",{className:"mt-2 mb-0 text-sm font-light text-gray-600 dark:text-gray-400",children:l})]})}},512:function(e,n,t){t.r(n);var o=t(5893),i=t(1151),s=t(3182);function a(e){var n=Object.assign({hr:"hr",h2:"h2",p:"p",a:"a",h3:"h3",code:"code",pre:"pre",ul:"ul",li:"li"},(0,i.a)(),e.components);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{children:'slug: "dns-ad-blocker-with-pi-hole-and-docker"\ntitle: "DNS Ad-blocker with Pi-hole and Docker"\ndescription: "All-in-one network solution for blocking ads"\npublishedAt: "2021-12-09"'}),"\n","\n",(0,o.jsx)(n.h2,{children:"What\u2019s Pi-hole?"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.a,{href:"https://pi-hole.net/",children:"Pi-hole"})," is an all-in-one network solution for blocking ads. By sitting as a middle-man between your router and devices it can accept all traffic as a gateway that decides what domains are allowed."]}),"\n",(0,o.jsx)(s.Z,{src:"/images/journal/dns-ad-blocker-with-pi-hole-and-docker/dashboard.webp",width:"1468",height:"1261"}),"\n",(0,o.jsx)(n.h2,{children:"The 4 pillars of Pi-hole"}),"\n",(0,o.jsx)(n.h3,{children:"\ud83d\udce1 Network Wide Protection"}),"\n",(0,o.jsx)(n.p,{children:"Instead of installing browser extensions or blockers for each individual device, you can let your Pi-hole have complete governance over your network. Therefore all of the devices connected to this network will be protected without the need of installing any additional software!"}),"\n",(0,o.jsx)(n.h3,{children:"\ud83d\udeab Block in-app ads"}),"\n",(0,o.jsx)(n.p,{children:"Sometimes tech companies get smart and put ads in unconventional places, like mobile apps and Smart TVs. In some cases, like a TV, installing a local ad-blocker is not even an opportunity. Yet again, Pi-hole comes to the rescue regardless of hardware or OS."}),"\n",(0,o.jsx)(n.h3,{children:"\u26a1\ufe0f Improve network latency"}),"\n",(0,o.jsx)(n.p,{children:"Since Pi-hole can block the HTTP query at a DNS level, filthy javascript trackers won\u2019t even reach your browser. This results in less packets and bandwidth usage. It might not be immediately noticeable, but significant in the long run."}),"\n",(0,o.jsx)(n.h3,{children:"\ud83e\udd13 Monitors stats"}),"\n",(0,o.jsx)(n.p,{children:"For all the \u201cnerds\u201d out there, Pi-hole comes with a full-fledged and battle-tested dashboard. It acts as a hub to monitor network traffic, permitted/blocked domains, clients, etc."}),"\n",(0,o.jsx)(n.h2,{children:"Getting Started"}),"\n",(0,o.jsxs)(n.p,{children:["Pi-hole officially supports a variety of ",(0,o.jsx)(n.a,{href:"https://docs.pi-hole.net/main/prerequisites/",children:"linux distributions"}),", but by leveraging ",(0,o.jsx)(n.a,{href:"https://www.docker.com/",children:"docker"})," and ",(0,o.jsx)(n.a,{href:"https://docs.docker.com/compose/",children:"docker-compose"})," we are going to automate installation & configuration for any platform."]}),"\n",(0,o.jsxs)(n.p,{children:["Note: For a one step automated install and manual configuration you can check out the ",(0,o.jsx)(n.a,{href:"https://github.com/pi-hole/pi-hole/#one-step-automated-install",children:"official guide"}),"."]}),"\n",(0,o.jsx)(n.h2,{children:"Docker"}),"\n",(0,o.jsxs)(n.p,{children:["Let\u2019s start by creating a ",(0,o.jsx)(n.code,{children:"docker-compose.yml"})," file that will take care of the configuration. Luckily the vibrant community from Pi-hole already has us covered with a ",(0,o.jsx)(n.a,{href:"https://github.com/pi-hole/docker-pi-hole/#running-pi-hole-docker",children:"docker image"})," ready for distribution."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yml",children:'version: "3"\n\nservices:\n  pihole:\n    container_name: pihole\n    image: pihole/pihole:latest\n    ports:\n      - "53:53/tcp"\n      - "53:53/udp"\n      - "67:67/udp"\n      - "80:80/tcp"\nenvironment:\n      TZ: "America/Los_Angeles"\n      WEBTHEME: "default-dark"\n      PIHOLE_DNS_: "1.1.1.1;1.0.0.1"\n      FTLCONF_REPLY_ADDR4: "192.168.0.143"\n      WEBPASSWORD: "${WEBPASSWORD}"\n    # Volumes store your data between container upgrades\n    volumes:\n      - "./etc-pihole/:/etc/pihole/"\n      - "./etc-dnsmasq.d/:/etc/dnsmasq.d/"\n    # Recommended but not required (DHCP needs NET_ADMIN)\n    # https://github.com/pi-hole/docker-pi-hole#note-on-capabilities\n    cap_add:\n      - NET_ADMIN\n    restart: unless-stopped\n'})}),"\n",(0,o.jsxs)(n.p,{children:["Most of the things are boilerplate, setting a ",(0,o.jsx)(n.code,{children:"container_name"})," that acts as display name, getting the docker ",(0,o.jsx)(n.code,{children:"image"}),", and opening the right ",(0,o.jsx)(n.code,{children:"ports"})," for communication between our container and the host. ",(0,o.jsx)(n.code,{children:"volumes"})," are used for persisting data across container upgrades."]}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"environment"})," is one the most important keys that defines our settings. Let\u2019s go over each one:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"TZ"}),": set a ",(0,o.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/List_of_tz_database_time_zones",children:"timezone"})," to make sure logs are timestamped with your local time."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"WEBTHEME"}),": set a user interface theme to use, options: ",(0,o.jsx)(n.code,{children:'"default-dark" | "default-darker" | "default-light"'})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"PIHOLE_DNS_"}),": set a DNS server that\u2019s going to resolve all network queries. The default is Google, but here I\u2019m manually changing it to Cloudfare."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"FTLCONF_REPLY_ADDR4"}),": set your host\u2019s LAN IP"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"WEBPASSWORD"}),": set a password that allows you to access the dashboard. You can set it directly inline, or through an external ",(0,o.jsx)(n.code,{children:".env"})," file. For doing the latter, create a file named ",(0,o.jsx)(n.code,{children:".env"})," in the same directory and add the following line: ",(0,o.jsx)(n.code,{children:"WEBPASSWORD=helloworld"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["The most important properties that are recommended to set are the last two. Everything else is optional, you can read more about it on their ",(0,o.jsx)(n.a,{href:"https://github.com/pi-hole/docker-pi-hole/#running-pi-hole-docker",children:"github"}),"."]}),"\n",(0,o.jsx)(n.h3,{children:"Installation"}),"\n",(0,o.jsxs)(n.p,{children:["Beforehand, you will need to have installed on your machine ",(0,o.jsx)(n.code,{children:"docker"})," and ",(0,o.jsx)(n.code,{children:"docker-compose"}),". Running is as simple as navigating to the directory of your ",(0,o.jsx)(n.code,{children:"docker-compose.yml"})," and typing ",(0,o.jsx)(n.code,{children:"docker compose up -d"}),"."]}),"\n",(0,o.jsx)(n.h2,{children:"Post Install"}),"\n",(0,o.jsx)(s.Z,{src:"/images/journal/dns-ad-blocker-with-pi-hole-and-docker/login.png",height:"1261px",width:"1468px"}),"\n",(0,o.jsxs)(n.p,{children:["In order to access the dashboard navigate to ",(0,o.jsx)(n.code,{children:"<FTLCONF_REPLY_ADDR4>/admin"}),". Now that we\u2019ve got our instance of Pi-hole running, the last step is to forward all traffic to it. Unfortunately, this topic is out of scope for this article. The ",(0,o.jsx)(n.a,{href:"https://docs.pi-hole.net/main/post-install/",children:"official documentation"})," extensively covers how to configure your router to have DHCP clients use Pi-hole as their DNS server."]}),"\n",(0,o.jsx)(n.h2,{children:"Voil\xe0!"}),"\n",(0,o.jsx)(n.p,{children:"Assuming that you have done your network setup, now you should have a dedicated ad-blocker for your whole household. In the past month since I\u2019ve set this, Pi-hole has blocked 152 queries. This result means that a bit over 1% of my network traffic is made up of advertisement & trackers and has been all blocked automatically by my Pi-hole instance."})]})}n.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.assign({},(0,i.a)(),e.components),t=n.wrapper;return t?(0,o.jsx)(t,Object.assign({},e,{children:(0,o.jsx)(a,e)})):a(e)}}}]);